<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vista detallada de película</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
        integrity="sha512-TdX7PtFTs5lCt4lwlBebN52Nq4ElCkIOHQ0pyAOn24NS+gZVv6b/2KA2RDpMBpbEe+BQiJqIp9nhffI3oyB+7A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="/css/peliculas/rDetailed.css" rel="stylesheet">

</head>

<body>

    <div class="modal" id="modal-name">
        <div class="modal-sandbox"></div>
        <div class="modal-box">
            <div class="modal-header">
                <div class="close-modal">&#10006;</div>
                <h1 style="text-align: center;">Modificacion de datos de la pelicula</h1>
            </div>
            <div class="modal-body">
                <form action="/pelicula/u" method="post">
                    <div class="form-group">
                        <label for="id-nombre">
                            <h4>Nombre</h4>
                        </label>
                        <input type="text" id="id-nombre" name="nombre" class="form-control" required
                            th:value="${pelicula.titulo}">
                    </div>
                    <div id="clasificacion" class="form-group">
                        <label for="id-clasificacion">
                            <h4>Clasificación</h4>
                        </label>
                        <input type="text" id="id-clasificacion" name="clasificacion" class="form-control" required
                            th:value="${pelicula.clasificacion}">
                    </div>
                    <div id="estado" class="form-group">
                        <label for="id-estado">
                            <h4>Estado</h4>
                        </label>
                        <input type="text" id="id-estado" name="estado" class="form-control" required
                            th:value="${pelicula.estado}">
                    </div>
                    <div id="fechaEstreno" class="form-group">
                        <label for="id-fechaSalida">
                            <h4>Fecha de estreno</h4>
                        </label>
                        <input type="date" id="id-fechaSalida" name="fechaSalida" class="form-control" required
                            th:value="${pelicula.fecha_salida}">
                    </div>
                    <div id="peliDuracion" class="form-group">
                        <label for="id-duracion">
                            <h4>Duración</h4>
                        </label>
                        <input type="text" id="id-duracion" name="duracion" class="form-control" required
                            th:value="${pelicula.duracion}">
                    </div>
                    <div class="form-group">
                        <h4>Plataforma</h4>
                        <input type="text" id="id-plataforma" name="plataforma" class="form-control"
                            th:value="${pelicula.plataforma}" />
                    </div>
                    <div class="form-group">
                        <label for="id-puntuacion">
                            <h4>Puntuacion</h4>
                        </label>
                        <input type="number" id="id-puntuacion" name="puntuacion" th:value="${pelicula.puntuacion}"
                            class="form-control">
                    </div>
                    <div class="form-group">
                        <h4>Cuenta votos</h4>
                        <input type="text" id="id-cuentaVotos" name="cuentaVotos" class="form-control"
                            th:value="${pelicula.cuenta_votos}" />
                    </div>
                    <div class="form-group">
                        <label for="id-trailer">
                            <h4>Ver trailer</h4>
                        </label>
                        <input type="text" id="id-trailer" name="trailer" th:value="${pelicula.trailer}"
                            class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="id-urlCompra">
                            <h4>URL de compra</h4>
                        </label>
                        <input type="text" id="id-urlCompra" name="urlCompra" th:value="${pelicula.url}"
                            class="form-control">
                    </div>
                    <div class="form-group">
                        <span>
                            <h4>Sinopsis</h4>
                            <textarea id="id-sinopsis" name="sinopsis" class="form-control"
                                th:text="${pelicula.sinopsis}"></textarea>
                        </span>
                    </div>
                    <div class="form-group">
                        <h4>Categorias</h4>
                        <th:block th:each="categoria : ${categorias}">
                            <input type="checkbox" name="categoriaId[]" class="option-input checkbox"
                                th:id="|idCategoria-${categoria.idCategoria}|" th:value="${categoria.idCategoria}"
                                th:checked="${pelicula.categorias.contains(categoria)}" />
                            <label th:for="|idCategoria-${categoria.idCategoria}|" th:text="${categoria.nombre}"
                                th:value="${categoria.idCategoria}"></label>
                        </th:block>
                    </div>
                    <input type="hidden" id="idpelicula" name="idpelicula" th:value="${pelicula.idElemento}">
                    <button type="submit" id="btnActualizar" class="btn btn-primary btn-block"
                        style="display: block; margin: 0 auto; margin-top:20px;">Guardar</button>

                </form>
                <button class="btn btn-danger close-modal">Cerrar</button>
            </div>
        </div>
    </div>
    <button th:if="${session.usuario!=null and session.usuario.esAdmin==true}" class="btn btn-primary modal-trigger "
        data-modal="modal-name"> <i class="bi bi-pen-fill"></i></button>
    <button th:if="${session.usuario != null and session.usuario.esAdmin == true}" id="borrarButton"
        class="btn btn-primary">
        Borrar
    </button>
    <div class="container mt-5">
        <h1 class="text-center highlight-text" th:text="${pelicula.titulo}"></h1>
        <div class="heart-container" title="Like">
            <form id="checklistForm" action="/pelicula/rDetailed" method="POST">
                <input type="hidden" name="idPelicula" th:value="${pelicula.idElemento}">
                <input type="checkbox" class="checkbox" name="favourite" id="Give-It-An-Id"
                    onclick="handleCheckboxClick()">
                <div class="svg-container">
                    <svg viewBox="0 0 24 24" class="svg-outline" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M17.5,1.917a6.4,6.4,0,0,0-5.5,3.3,6.4,6.4,0,0,0-5.5-3.3A6.8,6.8,0,0,0,0,8.967c0,4.547,4.786,9.513,8.8,12.88a4.974,4.974,0,0,0,6.4,0C19.214,18.48,24,13.514,24,8.967A6.8,6.8,0,0,0,17.5,1.917Zm-3.585,18.4a2.973,2.973,0,0,1-3.83,0C4.947,16.006,2,11.87,2,8.967a4.8,4.8,0,0,1,4.5-5.05A4.8,4.8,0,0,1,11,8.967a1,1,0,0,0,2,0,4.8,4.8,0,0,1,4.5-5.05A4.8,4.8,0,0,1,22,8.967C22,11.87,19.053,16.006,13.915,20.313Z">
                        </path>
                    </svg>
                    <svg viewBox="0 0 24 24" class="svg-filled" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M17.5,1.917a6.4,6.4,0,0,0-5.5,3.3,6.4,6.4,0,0,0-5.5-3.3A6.8,6.8,0,0,0,0,8.967c0,4.547,4.786,9.513,8.8,12.88a4.974,4.974,0,0,0,6.4,0C19.214,18.48,24,13.514,24,8.967A6.8,6.8,0,0,0,17.5,1.917Z">
                        </path>
                    </svg>
                    <svg class="svg-celebrate" width="100" height="100" xmlns="http://www.w3.org/2000/svg">
                        <polygon points="10,10 20,20"></polygon>
                        <polygon points="10,50 20,50"></polygon>
                        <polygon points="20,80 30,70"></polygon>
                        <polygon points="90,10 80,20"></polygon>
                        <polygon points="90,50 80,50"></polygon>
                        <polygon points="80,80 70,70"></polygon>
                    </svg>
                </div>
        </div>
        <button id="guardarBtn" style="display: none;" onclick="guardar()">Guardar</button>
        </form>
        <div class="row justify-content-center">

            <!-- Tarjeta para la información -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <div>
                            <span>
                                <h3>Sinopsis</h3>
                                <p id="id-sinopsis" name="sinopsis" class="" th:text="${pelicula.sinopsis}"
                                    disabled="disabled"></p>
                            </span>
                        </div>
                        <div class="form-group">
                            <h3>Ver trailer</h3>
                            <iframe width="560" height="315" th:src="${pelicula.trailer}" frameborder="0"
                                allowfullscreen></iframe>
                        </div>
                        <div class="form-group">
                            <h3>URL de compra</h3>
                            <a id="urlCompraLink" class="btn btn-secondary" name="urlCompraLink"
                                th:href="${pelicula.url}" target="_blank">Comprar</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card card-small card-offset">
                    <div class="card__content">
                        <div class="movie-poster">
                            <img th:src="@{'/img/peliculas/' + ${pelicula.imagen}}" alt="Poster de la película"
                                class="img-fluid">
                        </div>
                    </div>
                    <div class="blob"></div>
                    <div class="blob"></div>
                    <div class="blob"></div>
                    <div class="blob"></div>
                </div>
                <h1 class="text-center card-small contenidoArriba highlight-text">PUNTUACION</h1>
                <div id="cont" class="circuloSmall contenidoArriba" data-pct="">
                    <svg id="svg" width="200" height="200" viewPort="0 0 100 100" version="1.1"
                        xmlns="http://www.w3.org/2000/svg">
                        <circle r="90" cx="100" cy="100" fill="transparent" stroke-dasharray="565.48"
                            stroke-dashoffset="0"></circle>
                        <circle id="bar" r="90" cx="100" cy="100" fill="transparent" stroke-dasharray="565.48"
                            stroke-dashoffset="0"></circle>
                    </svg>
                </div>
                <input type="hidden" id="puntuacion" th:value="${pelicula.puntuacion}">
            </div>

        </div>
        <div class="row">
            <div class="card cardArriba">
                <div class="card-header bg-primary text-white">
                    <h1 class="text-center">Detalles</h1>
                </div>
                <div class="card-body">
                    <h2>Información respecto a la película</h2>
                    <ul>
                        <li>
                            <h3>Estado</h3>
                            <p class="card-text"><span th:utext="${pelicula.estado}"></span></p>
                        </li>
                        <li>
                            <h3>Clasificación</h3>
                            <p class="card-text"><span th:utext="${pelicula.clasificacion}"></span></p>
                        </li>
                        <li>
                            <h3>Duración</h3>
                            <p class="card-text"><span
                                    th:utext="'<i class=\'bi bi-alarm\'></i> ' + ${pelicula.duracion} + ' m.'"></span>
                            </p>
                        </li>
                        <li>
                            <h3>Fecha de salida</h3>
                            <p class="card-text"><span
                                    th:utext="'<i class=\'bi bi-calendar-event\'></i> ' + ${pelicula.fecha_salida}"></span>
                            </p>
                        </li>
                        <li>
                            <h3 style="display: none;">Cuenta votos</h3>
                            <p class="card-text"><span th:utext="${pelicula.cuenta_votos}"></span></p>
                        </li>
                        <li>
                            <h3 style="display: none;">Plataforma</h3>
                            <p class="card-text"><span th:utext="${pelicula.plataforma}"></span></p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


</body>
<script src="/js/peliculas/rDetailed.js" type="text/javascript"></script>

<script>
    function cambiarDireccionForm() {
        var form = document.querySelector('form[action="/juego/u"]');
        form.setAttribute('action', '/juego/d');
        // Cambiar el texto del botón a "Cancelar"
        var borrarButton = document.getElementById('btnActualizar');
        borrarButton.textContent = 'Borrar';
        borrarButton.classList.remove('btn-primary');
        borrarButton.classList.add('btn-danger');
    }

    function handleCheckboxClick() {
        var checkbox = document.getElementById("Give-It-An-Id");
        if (checkbox.checked) {
            document.getElementById("checklistForm").submit();
        }
    }


    function habilitarCampos() {
        // Obtener el valor del href de los botones de trailer y URL de compra
        var trailerLink = document.getElementById('trailerLink').getAttribute('href');
        var urlCompraLink = document.getElementById('urlCompraLink').getAttribute('href');

        // Convertir los botones de trailer y URL de compra a campos de texto
        var trailerCampo = document.getElementById('trailerLink');
        trailerCampo.outerHTML = '<input type="text" id="id-trailer" name="trailer" class="form-control" required value="' + trailerLink + '">';

        var urlCompraCampo = document.getElementById('urlCompraLink');
        urlCompraCampo.outerHTML = '<input type="text" id="id-urlCompra" name="urlCompra" class="form-control" required value="' + urlCompraLink + '">';

        // Obtener todos los elementos de formulario dentro del div con la clase "card-body"
        var campos = document.querySelectorAll('.card-body input, .card-body textarea');

        // Iterar sobre los elementos y habilitarlos
        campos.forEach(function (campo) {
            campo.removeAttribute('disabled');
        });

        // Mostrar el botón de guardar
        document.getElementById('btnActualizar').style.display = 'block';
    }
</script>


</html>