<link href="https://fonts.googleapis.com/css?family=Orbitron&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Caveat&display=swap" rel="stylesheet">



<style>
	/* Imagen de Spiderman */
	body {
		background: linear-gradient(to right, #39D2C0, #4B39EF);
		/*f2E9E4
		
		6C0E23
		B18FCF*/
		height: 100vh;
		margin: 0;
		font-family: 'Orbitron', sans-serif;
	}


	.container {
		display: table;
		text-align: center;
	}

	.footer {
		clear: both;
		/* Limpia los flotadores */
		position: relative;
		/* Cambia la posición a relativa */
		z-index: 1;
		/* Asegura que el footer esté encima del contenido */
		width: 100%;
		background-color: #24262b;
		padding: 70px 0;
	}

	.header-container {
		position: relative;
	}


	.header {
		color: #6C0E23;
		padding: 15px;
		height: 300px;
	}


	.container-usu {
		box-shadow: 0 0 50px rgba(0, 0, 0, .3);
		margin-top: -10px;
		overflow: hidden;
		width: 700px;
		background-color: rgba(255, 255, 255, 0.8);
		border-radius: 10px;
		box-sizing: border-box;
		padding: 20px;
		position: relative;
		left: 390px;



		/*top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);*/
	}


	.main-heading {
		color: #6C0E23;
		font-size: 26px;
		font-weight: 300;
		margin-bottom: 12px;
	}

	.tag {
		background-color: rgba(255, 255, 255, .35);
		border-radius: 20px;
		font-size: 11px;
		margin-right: 8px;
		padding: 4px 10px;
		text-transform: uppercase;
	}

	.stats {
		margin-top: 35px;
	}

	.stat-module {
		display: inline-block;
		font-size: 12px;
		margin-right: 20px;
		text-transform: uppercase;
	}

	.stat-number {
		display: inline-block;
		font-weight: 600;
		margin-left: 4px;
	}

	.overlay-header {
		background-color: rgba(255, 255, 255, .35);
		height: 100px;
		margin: -50px 0 0 -25%;
		transform: rotate(-10deg);
		width: 150%;
		z-index: 0;
	}

	.body {
		background-color: #eee;
		color: #555;
		margin-top: -50px;
		padding: 0 15px 15px;
		position: relative;
	}

	.body-image {
		border-radius: 100%;
		box-shadow: 5px 10px 75px rgba(0, 0, 0, .4);
		float: left;
		margin: -90px 0 20px;
		position: relative;
		z-index: 2;
	}

	.body-stats {
		display: inline-block;
		font-size: 12px;
		font-weight: 700;
		float: left;
		margin: -14px 0 0 30px;
		position: relative;
		text-transform: uppercase;
		width: 20%;
	}

	.body-stats>span {
		display: inline-block;
		font-weight: 900;
		margin-top: 8px;
	}

	.body-info {
		clear: left;
		position: relative;
		max-height: 100px;
		overflow: hidden;
		transition: all 600ms ease-out;
	}

	.body-more {
		background: -moz-linear-gradient(top, rgba(0, 0, 0, 0) 0%, rgba(238, 238, 238, 1) 100%);
		background: -webkit-linear-gradient(top, rgba(0, 0, 0, 0) 0%, rgba(238, 238, 238, 1) 100%);
		background: linear-gradient(to bottom, rgba(0, 0, 0, 0) 0%, rgba(238, 238, 238, 1) 100%);
		filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#00000000', endColorstr='#eeeeee', GradientType=0);
		cursor: pointer;
		margin: -57px auto 0px;
		padding: 20px 0 20px;
		position: relative;
		text-align: center;
	}

	.body-more span {
		background-color: #fff;
		border-radius: 50%;
		box-shadow: 1px 1px 5px rgba(0, 0, 0, .3);
		display: inline-block;
		height: 6px;
		margin-right: 2px;
		width: 6px;
	}

	.card {
		background: #fff;
		border-radius: 2px;
		box-shadow: 0 0 5px rgba(0, 0, 0, .15);
		margin-top: 15px;
		padding: 10px;
	}

	.card-heading {
		font-size: 12px;
		text-transform: uppercase;
	}

	.card-list {
		list-style-type: none;
		margin: 10px 0 0;
		overflow-x: scroll;
		padding: 0;
		white-space: nowrap;
	}

	.card-list::-webkit-scrollbar-track {
		-webkit-box-shadow: inset 0 0 2px rgba(0, 0, 0, 0.3);
		border-radius: 2px;
		background-color: #F5F5F5;
	}

	.card-list::-webkit-scrollbar {
		height: 3px;
		background-color: #F5F5F5;
	}

	.card-list::-webkit-scrollbar-thumb {
		border-radius: 10px;
		-webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, .2);
		background-color: #ddd;
	}

	.card-list li {
		display: inline;
		margin-left: 10px;
	}

	.card-list li:first-child {
		margin-left: 0;
	}

	/* Cambio de cursor */
	#puntos {
		cursor: pointer;
		/* Cambia el cursor predeterminado a un dedo */
	}

	/* Div que salen las películas */
	.card.u-clearfix {
		overflow-y: auto;
		max-height: 300px;
		border: 1px solid #ddd;
		border-radius: 5px;
		padding: 10px;
		background-color: #f9f9f9;
	}

	.card-heading {
		display: block;
		font-size: 18px;
		font-weight: bold;
		margin-bottom: 10px;
	}

	.card-list {
		list-style-type: none;
		padding: 0;
		margin: 0;
		display: flex;
		flex-wrap: wrap;
		justify-content: space-between;
	}

	.card-list li {
		width: calc(33.33% - 20px);
		margin-bottom: 20px;
		border: 1px solid #ddd;
		border-radius: 5px;
		overflow: hidden;
	}

	.card-list li img {
		width: 100%;
		height: auto;
		display: block;
	}

	.body-info {
		background-color: #f9f9f9;
		border-radius: 5px;
		padding: 20px;
		margin-bottom: 20px;
	}

	.body-info p {
		margin-bottom: 15px;
		line-height: 1.6;
	}

	.body-more {
		text-align: center;
	}

	.body-more span {
		display: inline-block;
		width: 10px;
		height: 10px;
		border-radius: 50%;
		background-color: #ccc;
		margin: 0 5px;
		cursor: pointer;
	}

	.body-more span.active {
		background-color: #555;
	}

	.edit-icon,
	.accept-btn,
	.cancel-btn,
	.edit-overlay,
	.input-title,
	.input-description,
	.save-btn,
	.cancel-edit-btn {
		display: none;
	}

	.show-edit .edit-icon {
		display: block;
	}

	.show-edit .title,
	.show-edit .description,
	.show-edit .input-title,
	.show-edit .input-description,
	.show-edit .edit-overlay,
	.show-edit .save-btn,
	.show-edit .cancel-edit-btn {
		display: block;
	}

	.show-edit .title,
	.show-edit .description {
		display: none;
	}

	.show-edit .input-title,
	.show-edit .input-description {
		width: 100%;
		border: none;
		border-radius: 5px;
		padding: 10px;
		box-sizing: border-box;
		margin-bottom: 10px;
	}

	.show-edit .save-btn,
	.show-edit .cancel-edit-btn {
		padding: 10px 20px;
		border: none;
		border-radius: 5px;
		cursor: pointer;
	}

	.show-edit .save-btn {
		background-color: #4CAF50;
		color: #fff;
		margin-right: 10px;
	}

	.show-edit .cancel-edit-btn {
		background-color: #f44336;
		color: #fff;
	}

	/* Estilos para aceptar o cancelar la edición */
	.edit-container {
		text-align: center;
		margin-top: 10px;
	}

	.accept-btn,
	.cancel-btn {
		padding: 5px 10px;
		border: none;
		border-radius: 5px;
		cursor: pointer;
		font-size: 14px;
	}

	.accept-btn {
		background-color: #4CAF50;
		color: white;
	}

	.cancel-btn {
		background-color: #f44336;
		color: white;
	}

	.edit-icon {
		cursor: pointer;
		font-size: 16px;
	}

	.edit-overlay {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-color: rgba(0, 0, 0, 0.5);
		z-index: 10;
		display: none;
	}

	.edit-container {
		display: flex;
		justify-content: center;
		align-items: center;
		height: 100%;
		position: relative;
	}

	.edit-container input {
		margin-right: 10px;
	}

	.edit-buttons {
		display: flex;
		justify-content: center;
		margin-top: 10px;
	}

	.edit-buttons button {
		margin: 0 5px;
	}

	/* Estilos para el botón de cambio de fondo */
	.change-bg-container {
		display: flex;
		justify-content: space-between;
		margin-top: 20px;
	}

	.change-bg-btn,
	.change-profile-btn {
		padding: 10px 20px;
		background-color: #4CAF50;
		color: white;
		border: none;
		border-radius: 5px;
		cursor: pointer;
		font-size: 16px;
	}

	/* Estilos para el input de selección de archivo */
	.file-input {
		display: none;
	}

	.profile-container {
		display: flex;
		align-items: center;
	}

	.profile-container img {
		border-radius: 50%;
		margin-right: 10px;
	}

	.profile-btn-container {
		display: flex;
		flex-direction: column;
	}

	.pelicula-item {
		position: relative;
		overflow: hidden;
	}

	.pelicula-img {
		max-width: 100px;
		margin-right: 15px;
	}

	.btn-eliminar {
		width: 100%;
	}
</style>


</head>

<body>
	<div class="m-3 container-usu">
		<div class="header-container">
			<div class="header">

				<div class="change-bg-container">
					<h1 class="main-heading" th:text="${session.usuario.nombre}"></h1>
					<button class="change-bg-btn"><i class="bi bi-arrow-bar-up">Fondo</i> </button>
					<input type="file" class="file-input" accept="image/*">
				</div>
				<span class="tag" id="puntos">Puntos</span>
				<div class="stats">
					<!-- Esto es para que muestre la cantidad de peliculas -->
					<span class="stat-module">Películas <span class="stat-number" id="cantidadPeliculas"></span></span>
					<span class="stat-module">Videojuegos <span class="stat-number" id="cantidadJuegos"></span></span>
				</div>
			</div> <!-- END header -->
		</div>

		<div class="overlay-header"></div>

		<div class="body">

			<!-- <img src="https://i.postimg.cc/C1DT0ffF/HGDF.jpg" alt="Hugh Jackman" class="body-image" /> -->
			<div class="profile-container">
				<!-- <img src="https://i.postimg.cc/C1DT0ffF/HGDF.jpg" alt="Hugh Jackman" class="body-image" id="profileImage" width="150" />
                <div class="profile-btn-container">
                    <button class="change-profile-btn"><i class="bi bi-arrow-bar-up"> Cambiar Perfil</i></button>
                    <input type="file" class="file-input-profile" accept="image/*">
                </div> -->

				<div>
					<img src="https://i.postimg.cc/C1DT0ffF/HGDF.jpg" alt="Hugh Jackman" id="profile-image"
						class="body-image">
					<button class="change-bg-btn" onclick="document.getElementById('profile-file-input').click()">Añadir
						foto</button>
					<input type="file" id="profile-file-input" class="file-input" accept="image/*"
						style="display: none;" onchange="uploadProfileImage()">
				</div>
			</div>
			<div id="description" class="body-info">
				<!-- Descripción -->
				<p id="user-description" th:text="${session.usuario.descripcion}"></p>
				<!-- Ícono de editar -->
				<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#editarDescripcionModal">
					✎Descripción
				</button>
				<!-- Modal para editar la descripción -->
				<div class="modal fade" id="editarDescripcionModal" tabindex="-1" role="dialog"
					aria-labelledby="editarDescripcionModalLabel" aria-hidden="true">
					<div class="modal-dialog" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="editarDescripcionModalLabel">Editar descripción</h5>
								<button type="button" class="close" data-dismiss="modal" aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
							</div>
							<div class="modal-body">
								<!-- Aquí se mostrará el mensaje -->
								<div id="modalMensaje" style="display: none; margin-bottom: 10px;" class="alert"></div>
								<form id="editarDescripcionForm">
									<div class="form-group">
										<label for="nuevaDescripcion">Nueva descripción:</label>
										<textarea class="form-control" id="nuevaDescripcion"
											name="nuevaDescripcion"></textarea>
									</div>
									<button type="submit" class="btn btn-primary">Guardar cambios</button>
								</form>
							</div>
						</div>
					</div>
				</div>

			</div>


		</div>

		<div id="peliculas" class="card u-clearfix">
			<span class="card-heading">Películas favoritas</span>
			<ul class="card-list">
				<!-- Itera sobre las películas favoritas del usuario y muestra cada una -->
				<li th:each="pelicula : ${peliculasFavoritas}">
					<!-- Muestra la imagen de la película -->
					<img th:src="@{'/img/peliculas/' + ${pelicula.imagen}}" />
					<!-- Muestra el título de la película -->
					<!-- <span th:text="${pelicula.titulo}"></span> -->
					<!-- Botón de eliminación -->
					<button class="btn btn-danger btn-sm btn-eliminar mt-2">
						Eliminar
					</button>
				</li>
			</ul>
		</div>


		<div id="juegos" class="card u-clearfix">
			<span class="card-heading">Juegos favoritos</span>
			<ul class="card-list">
				<!-- Itera sobre los juegos favoritos del usuario y muestra cada uno -->
				<li th:each="juego : ${juegosFavoritos}">
					<!-- Muestra la imagen del juego -->
					<img th:src="@{'/img/juegos/' + ${juego.imagen}}" />
					<!-- Muestra el título de la película -->
					<!-- <span th:text="${juego.titulo}"></span> -->

				</li>
			</ul>
		</div>
	</div>

	</div>
</body>


<script>
	// //// //// //// FUNCIÓN DE LOS PUNTOS//// //// //// //// //
	$(document).ready(function () {
		// Agrega un evento de clic al span de puntos
		$("#puntos").click(function () {
			// Hacer una solicitud HTTP GET al backend para obtener los puntos del usuario
			$.get("obtenerPuntos", function (data) {
				// Actualizar el contenido del span de puntos con los datos recibidos
				$("#puntos").text("Puntos: " + data.puntos);
			});
		});
	});

	// FUNCIÓN PARA MANDAR LOS DATOS EDITADOS DE LA DESCRIPCIÓN
	$(document).ready(function () {
		$('#editarDescripcionForm').submit(function (event) {
			event.preventDefault(); // Evitar que el formulario se envíe automáticamente

			// Obtener la nueva descripción del usuario del campo de texto
			var nuevaDescripcion = $('#nuevaDescripcion').val();

			// Enviar la nueva descripción al servidor usando AJAX
			$.ajax({
				type: 'POST',
				url: '/usuario/actualizarDescripcion',
				data: { nuevaDescripcion: nuevaDescripcion }, // Datos a enviar al servidor
				success: function (response) {
					// Manejar la respuesta del servidor (opcional)
					console.log('Descripción actualizada correctamente');

					// Mostrar mensaje de éxito en el modal
					$('#modalMensaje').removeClass('alert-danger').addClass('alert-success').text('Descripción actualizada correctamente.Los datos se mostrarán en el siguiente login.').show();

					// Opcional: Cerrar el modal después de un tiempo
					setTimeout(function () {
						$('#editarDescripcionModal').modal('hide');
						$('#modalMensaje').hide();
					}, 3000);
				},
				error: function (xhr, status, error) {
					// Manejar errores de AJAX (opcional)
					console.error('Error al actualizar la descripción:', error);
				}
			});
		});
	});

	//Función para obtener al número de películas favoritas 
	$(document).ready(function () {
		// Hacer una solicitud HTTP GET al backend para obtener el número de películas favoritas
		$.get("cantidadPeliculasFavoritas", function (data) {
			// Actualizar el contenido del elemento con el número de películas favoritas recibido
			$("#cantidadPeliculas").text(data);
		}).fail(function (xhr, status, error) {
			console.error("Error al obtener la cantidad de películas favoritas:", error);
			$("#cantidadPeliculas").text("0");
		});
	});



	//Función para obtener al número de juegos favoritos 
	$(document).ready(function () {
		// Hacer una solicitud HTTP GET al backend para obtener el número de películas favoritas
		$.get("cantidadJuegosFavoritos", function (data) {
			// Actualizar el contenido del elemento con el número de películas favoritas recibido
			$("#cantidadJuegos").text(data);
		}).fail(function (xhr, status, error) {
			console.error("Error al obtener la cantidad de juegos favoritos:", error);
			$("#cantidadJuegos").text("0");
		});

		$('.change-bg-btn').on('click', function () {
			$('.file-input').click(); // Cambiado a '.file-input' en lugar de '.file-input-bg'
		});

		$('.file-input').on('change', function (e) { // Cambiado a '.file-input' en lugar de '.file-input-bg'
			const file = e.target.files[0];
			if (file) {
				const reader = new FileReader();
				reader.onload = function (event) {
					$('body').css('background-image', `url(${event.target.result})`);
				};
				reader.readAsDataURL(file);
			}
		});

		// Cambiar imagen de perfil
		$('.change-profile-btn').on('click', function () {
			$('.file-input-profile').click();
		});

		$('.file-input-profile').on('change', function (e) {
			const file = e.target.files[0];
			if (file) {
				const reader = new FileReader();
				reader.onload = function (event) {
					$('#profileImage').attr('src', event.target.result);
				};
				reader.readAsDataURL(file);
			}
		});
	});



</script>


<script>
	function uploadImage() {
		var fileInput = document.getElementById('file-input');
		var file = fileInput.files[0];
		var formData = new FormData();
		formData.append('file', file);

		$.ajax({
			url: '/usuarios/{id}/uploadFoto',  // Reemplaza {id} con el ID real del usuario
			type: 'POST',
			data: formData,
			processData: false,
			contentType: false,
			success: function (response) {
				alert('Foto de fondo subida exitosamente');
			},
			error: function (jqXHR, textStatus, errorThrown) {
				alert('Error subiendo la foto de fondo');
			}
		});
	}

	function uploadProfileImage() {
		var fileInput = document.getElementById('profile-file-input');
		var file = fileInput.files[0];
		var formData = new FormData();
		formData.append('file', file);

		$.ajax({
			url: '/usuario/uploadFotoPerfil',  // URL para subir la foto de perfil
			type: 'POST',
			data: formData,
			processData: false,
			contentType: false,
			success: function (response) {
				alert('Foto de perfil subida exitosamente');
				// Actualizar la imagen de perfil en el DOM
				var reader = new FileReader();
				reader.onload = function (e) {
					document.getElementById('profile-image').src = e.target.result;
				}
				reader.readAsDataURL(file);
			},
			error: function (jqXHR, textStatus, errorThrown) {
				alert('Error subiendo la foto de perfil');
			}
		});
	}
</script>


</html>